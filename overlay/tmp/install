#!/bin/sh

set -euo pipefail
export BF_E=`basename ${0}`


#======================================================================================================================
# Get vsftpd version.
#======================================================================================================================

cd /tmp

VERSION=$(cat VSFTPD_VERSION)
bf-debug "vsftpd version ${VERSION}."


#======================================================================================================================
# Install vsftpd and dependencies.
#======================================================================================================================

bf-echo "Installing vsftpd v${VERSION}..."
apk add --no-cache \
    lftp \
    openssl \
    vsftpd=${VERSION}
bf-done


#======================================================================================================================
# Cleanup.
#======================================================================================================================

bf-debug "Cleaning up default vsftpd and SSL files."
rm -rf /etc/vsftpd/* /etc/ssl/private


#======================================================================================================================
# Create and link ftps directories.
#======================================================================================================================

bf-debug "Creating and linking ftps directories."

mkdir /files

mkdir /ssl
ln -s /ssl /etc/ssl/private
